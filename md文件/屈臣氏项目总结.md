#### 一.创建项目
## 1.1 安装node，官网选稳定版
## 1.2 安装淘宝镜像  npm install -g cnpm --registry=https://registry.npm.taobao.org
## 1.3 全局安装脚手架 npm install -g create-react-app
## 1.4 定位到你将要创建项目的目录 
D： 
cd www
## 1.5 创建项目
create-react-app react-router-qcs
## 1.6 进入项目目录  ，执行
cd react-router-qcs
npm start 
如果看到提示，Compiled successfully! 说明项目创建成功了

在任何一个浏览器中 输入 127.0.0.1:3000 或10.10.10.114:3000 可以访问项目并查看效果

#### 二.安装依赖
cnpm install --save react-router-dom axios http-proxy-middleware@0.20.0 react-flexible swiper@3.4.2 antd reset-css
cnpm install --save-dev scss scss-loader node-sass

#### 三.创建页面，配置路由信息
## 3.1  将App.css  App.js  App.test.js 删除
## 3.2 创建三个页面
src/pages/main/index.js
```
import React, { Component } from 'react';

class main extends Component {
    render() {
        return (
            <div>
                今日推荐
            </div>
        );
    }
}
export default main;
```
src/pages/mask/index.js
src/pages/global/index.js
## 3.3 创建路由文件
src/router/index.js
```
//路由
import React from 'react';
import {Route,Link,BrowserRouter} from 'react-router-dom';
//引入页面
import main from '../pages/main';
import global from '../pages/global';
import mask from '../pages/mask';
//路由表
const App = ()=>(
    <BrowserRouter>
        <div>
            <Link to="/" exact={true}>今日推荐</Link>
            <Link to="/mask">面膜中心</Link>
            <Link to="/global">购全球</Link>
        </div>
        <div>
            <Route path="/" exact={true} component={main} />
            <Route path="/mask" component={mask} />
            <Route path="/global" component={global} />
        </div>
    </BrowserRouter>
)
//输出路由
export default App;
```

## 3.4 修改了src/index.js
```
//引入路由
-+ import App from './router';
```

#### 四.头部封装组件
## 4.1 创建 组件  ， 组件的名称首字母大写
src/components/common/myheader.js
```
import React, { Component } from 'react';
class Myheader extends Component {
    render() {
        return (
            <div>
                头部
            </div>
        );
    }
}
export default Myheader;
```

## 4.2 将头部引入到 src/router/index.js
```
//引入组件 ,组件的名称首字母必须大写
+ import Myheader from '../components/common/myheader.js';

const App = ()=>(
    <BrowserRouter>
        <div>
+            <Myheader />
        </div>
        <div>
            <Route path="/" exact={true} component={main} />
            <Route path="/mask" component={mask} />
            <Route path="/global" component={global} />
        </div>
    </BrowserRouter>
)
```
## 4.3 将antd的css样式引入到 src/index.js
```
import "antd/dist/antd.min.css";
```

## 4.4 添加新的scss文件
src/components/common/myheader.scss
```
.hsearch{
    height:50px;
    line-height: 50px;
    .user,.shop{text-align: center; 
        font-size: 20px;
        color:#666;
    }
    .search{border-radius: 30px;}

}
.hnav{
    display: flex;justify-content: space-around; height:40px;line-height: 40px;
    font-size:14px; font-weight: bold;
    a{color:#000;}
    .active{color:#ff6692; border-bottom:3px solid #ff6699;}
}
```
## 4.5 修改 src/components/common/myheader.js
```
//头部
import React, { Component } from 'react';
import {NavLink} from 'react-router-dom';
//引入小图标
import {UserOutlined,ShoppingCartOutlined,SearchOutlined} from '@ant-design/icons';
//引入antd的行列
import { Row, Col,Input  } from 'antd';
//引入样式
import "./myheader.scss";
class Myheader extends Component {
    render() {
        return (
            <div>
                <Row className="hsearch" >
                    <Col span={4} className="user"><UserOutlined  /></Col>
                    <Col span={16}><Input placeholder="保湿面膜0.1元" prefix={<SearchOutlined />} className="search" /></Col>
                    <Col span={4} className="shop" ><ShoppingCartOutlined /></Col>
                </Row>
                <div className="hnav">
                    <NavLink to="/" exact={true}>今日推荐</NavLink>
                    <NavLink to="/mask">面膜中心</NavLink>
                    <NavLink to="/global">购全球</NavLink>
                </div>
            </div>
        );
    }
}

export default Myheader;
```

#### 五.首页获取轮播数据，并渲染
## 5.1 解决跨域问题
修改 package.json  文件
```
"version": "0.1.0",
  "private": true,
+  "proxy":"https://h5.watsons.com.cn/",
  "dependencies":....
``` 
重要： 添加之后，重启服务器

## 5.2 修改src/pages/main/index.js
```
import React, { Component } from 'react';
import axios from 'axios';

//引入swiper的js，css
import Swiper from 'swiper/dist/js/swiper.min.js'; 
import 'swiper/dist/css/swiper.min.css';
import "./index.scss";
class main extends Component {
    constructor(){
        super();
        this.state = {
            swiperList:[]
        }
    }

    componentDidMount(){
        axios.get('aladdin/get_batch_data?codes=[%22sylunbo%22,%22%E4%B8%B4%E6%97%B6%E6%96%B0%E4%BA%BA%E4%B8%93%E4%BA%AB-%E5%A4%B4%E5%9B%BE%22,%22pingou_B%22,%22Home_TopicCase_170505_7%22,%22Home_CategaryNavs_170505_7%22]&province_code=&city_code=&version=&app_channel=wap&plat=wap&access_token=&device_id=098dde70-0dbb-11eb-b136-6379bb6f82d5').then(res=>{
            console.log(res);
            this.setState({
                swiperList:res.data.data.sylunbo.datas
            },function(state){
                console.log('qq');
                console.log(this.state);
            })
        });

        new Swiper('.swiper-container', {
            pagination: '.swiper-pagination',
            paginationClickable: true,
            observer:true,//异步数据需要配置
            loop:true,
            autoplay:1000
        });

    }
    render() {
        const {swiperList} = this.state;
        return (
            <div>
                今日推荐
                <div className="swiper-container">
                    <div className="swiper-wrapper">
                        {swiperList.map(item=><div className="swiper-slide" key={item.id} ><img src={item.image_url} /></div> )}
                        
                    </div>
                    <div className="swiper-pagination"></div>
                </div>
            </div>
        );
    }
}
export default main;
```
## 5.3 新建src/pages/main/index.scss
```
.swiper-container{
    .swiper-wrapper{
        .swiper-slide{
            img{width:100%;}
        }
    }
}
```

#### 六. 为什么有跨域问题，怎样解决
前端有同源保护政策，前端在设计之初就考虑到前端代码的不安全性；
因为有同源保护政策，跨域或跨源获取数据时就存在跨域问题，
解决方法： 
6.1 jsonp 缺点：只能get，不能post; jsonp的原理:script标签的src属性具有跨域的能力；一般在 原生或 jquery中使用
6.2 proxy 使用代理解决跨域问题; 缺点：打包后不能使用；打包后需要服务器配置 nginx ；vue、react
6.3 后台配置包的头部语序跨域 cors
其他的跨域方式：https://blog.csdn.net/yup1212/article/details/87633272、

#### 七.组件封装
## 7.1 创建 轮播图组件
src/components/main/mainswiper/index.js
```
import React, { Component } from 'react';
//引入swiper的js，css
import Swiper from 'swiper/dist/js/swiper.min.js'; 
import 'swiper/dist/css/swiper.min.css';
import './index.scss';
class Mainswiper extends Component {
    componentDidMount(){
        setTimeout(()=>{
            new Swiper('.swiper-container', {
                pagination: '.swiper-pagination',
                paginationClickable: true,
                observer:true,//异步数据需要配置
                loop:true,
                autoplay:1000
            });
        },1000);
    }
    render() {
        const {swiperList} = this.props;
        return (
            <div>
                 <div className="swiper-container">
                    <div className="swiper-wrapper">
                        {swiperList.map(item=><div className="swiper-slide" key={item.id} ><img src={item.image_url} /></div> )}
                        
                    </div>
                    <div className="swiper-pagination"></div>
                </div>
            </div>
        );
    }
}

export default Mainswiper;
```
src/components/main/mainswiper/index.scss
```
.swiper-container{
    .swiper-wrapper{
        .swiper-slide{
            img{width:100%;}
        }
    }
}
```
## 7.2 修改 src/pages/main/index.js
```
import React, { Component } from 'react';
import axios from 'axios';
//引入轮播组件
import Mainswiper from '../../components/main/mainswiper';
class main extends Component {
    constructor(){
        super();
        this.state = {
            swiperList:[]
        }
    }

    componentDidMount(){
        axios.get('aladdin/get_batch_data?codes=[%22sylunbo%22,%22%E4%B8%B4%E6%97%B6%E6%96%B0%E4%BA%BA%E4%B8%93%E4%BA%AB-%E5%A4%B4%E5%9B%BE%22,%22pingou_B%22,%22Home_TopicCase_170505_7%22,%22Home_CategaryNavs_170505_7%22]&province_code=&city_code=&version=&app_channel=wap&plat=wap&access_token=&device_id=098dde70-0dbb-11eb-b136-6379bb6f82d5').then(res=>{
            console.log(res);
            this.setState({
                swiperList:res.data.data.sylunbo.datas
            },function(state){
                console.log('qq');
                console.log(this.state);
            })
        });
    }
    render() {
        const {swiperList} = this.state;
        return (
            <div>
                <Mainswiper swiperList={swiperList}/>
            </div>
        );
    }
}
export default main;
```

#### 八. 将 axios 进行封装
## 8.1 创建 utils/http.js
```
//封装axios
import React from 'react'; 
import axios from 'axios';
// 参数解析
import  qs from 'qs';
//默认的url地址
const baseurl = "";
//请求拦截
axios.interceptors.request.use(
    config=>{
        //配置 token验证 vue 
        return config;
    },
    err =>{
        console.log("请求出错");
    }
)

//响应拦截
axios.interceptors.response.use(
    data=>{
        return data
    },
    err=>{
        if(err.response.status === 404){
            console.log("页面地址出错");
        }else if(err.response.status === 401){
            console.log("登录信息出错，请求参数问题");
        }else if(err.response.status === 405){
            console.log("请求方式错误"); 
        }else if(err.response.status === 500 || err.response.status === 504){
            console.log("服务器端报错，请和后台工作人员联系"); 
        }
        return Promise.reject(err);
    }

)

//封装get和post请求
let http = {
    get:'',
    post:''
}

http.get = function(api,data){
    let params = qs.stringify(data);
    return new Promise((resolve,reject)=>{
        axios.get(baseurl+api,params).then(res=>{
            resolve(res);
        })
    })
}
http.post = function(api,data){
    let params = qs.stringify(data);
    return new Promise((resolve,reject)=>{
        axios.post(baseurl+api,params).then(res=>{
            resolve(res);
        })
    })
}

export default http;
```
## 8.2 创建 utils/api.js
```

import http from './http';

//1.获取首页轮播的数据
export const swiperData = async()=>{
    return await http.get('aladdin/get_batch_data?codes=[%22sylunbo%22,%22%E4%B8%B4%E6%97%B6%E6%96%B0%E4%BA%BA%E4%B8%93%E4%BA%AB-%E5%A4%B4%E5%9B%BE%22,%22pingou_B%22,%22Home_TopicCase_170505_7%22,%22Home_CategaryNavs_170505_7%22]&province_code=&city_code=&version=&app_channel=wap&plat=wap&access_token=&device_id=098dde70-0dbb-11eb-b136-6379bb6f82d5');
}
//2.今日秒杀的数据


//3.精选必买

```
## 8.3 修改 src/pages/main/index.js
```
- import axios from 'axios';

- axios.get('aladdin/get_batch_data?codes=[%22sylunbo%22,- %22%E4%B8%B4%E6%97%B6%E6%96%B0%E4%BA%BA%E4%B8%93%E4%BA%AB-%E5%A4%B4%E5%9B%BE%22,%22pingou_B%22,%22Home_TopicCase_170505_7%22,%22Home_CategaryNavs_170505_7%22]&province_code=&city_code=&version=&app_channel=wap&plat=wap&access_token=&device_id=098dde70-0dbb-11eb-b136-6379bb6f82d5').then(res=>{
-            console.log(res);
-            this.setState({
-                swiperList:res.data.data.sylunbo.datas
-            },function(state){
-                console.log('qq');
-                console.log(this.state);
-            })
-        });

//引入api
+ import {swiperData} from '../../utils/api';
+ swiperData().then(res=>{
+            console.log(res);
+            this.setState({
+                swiperList:res.data.data.sylunbo.datas
+            })
+        })
```

#### 九. 秒杀
## 9.1 引入reset-css  重置浏览器的默认样式，引入 flexible,将px转rem
src/index.js
```
//重置浏览器样式
import 'reset-css';
//引入rem-px   为了兼容移动端的所有手机的宽度
import "react-flexible";
```
添加完之后 ，vscode需要下载 pxtorem插件，并且配置 https://blog.csdn.net/wjnf012/article/details/92074232

## 9.2 获取秒杀数据
src/utils/api.js
```
//2.今日秒杀的数据
export const miaoshaData = async()=>{
    //https://h5.watsons.com.cn/activity/specials/info?count=8&code=Home_flashSale__Top_Img&stock_code=&device_id=fd91e420-0f4c-11eb-a595-514ffb010224
    return await http.get("activity/specials/info?count=8&code=Home_flashSale__Top_Img&stock_code=&device_id=fd91e420-0f4c-11eb-a595-514ffb010224");
}
```

## 9.3 创建子组件 
src/components/main/miaosha/index.js
```
import React, { Component } from 'react';

class Miaosha extends Component {
    render() {
        return (
            <div>
               秒杀组件 
            </div>
        );
    }
}
export default Miaosha;
```
## 9.4 修改 main里面的代码，引入数据，引入组件
```
import React, { Component } from 'react';
//引入轮播组件
import Mainswiper from '../../components/main/mainswiper';
//引入秒杀组件
+ import Miaosha from '../../components/main/miaosha'; 
//引入api
-+ import {swiperData,miaoshaData} from '../../utils/api';
class main extends Component {
+    constructor(){
+        super();
+        this.state = {
+            swiperList:[],
+            miaoshaList:[],
+            nowTime:0,//获取服务器上的现在时间
+            endTime:0//服务器上的结束时间
+        }
+    }
    componentDidMount(){
        swiperData().then(res=>{
           // console.log(res);
            this.setState({
                swiperList:res.data.data.sylunbo.datas
            })
        })
        //获取秒杀数据
+        miaoshaData().then(res=>{
+           // console.log(res);
+            this.setState({
+                miaoshaList:res.data.data.specials_item_v_o_s,
+                nowTime:res.data.data.now,
+                endTime:res.data.data.specials_time_ranges[0].end
+            },function(state){
+               // console.log(this.state.miaoshaList,this.state.nowTime,this.state.endTime);
+            })
+        })
    }
    render() {
-+        const {swiperList,miaoshaList,nowTime,endTime} = this.state;
        return (
            <div>
                <Mainswiper swiperList={swiperList}/>
                {/* 秒杀组件 */}
+                <Miaosha miaoshaList={miaoshaList} nowTime={nowTime} endTime={endTime} />
            </div>
        );
    }
}
export default main;
```
## 9.5 更改组件中的代码
创建 src/components/main/miaosha/index.scss
```
.miaosha{
    .ms_list{width: 100%; overflow-x: auto; overflow-y: hidden;
        ul{width:50rem; display: flex; justify-content: space-around;
            li{   
                width: 2.53333rem;
                height: 3.97333rem;
                border: 1px solid #ededed;
                border-radius: 0.08rem;
                background: #fff;
                img{width: 100%;}
            }
        }
    }

}
```
修改 src/components/main/miaosha/index.js
```
import React, { Component } from 'react';
import './index.scss';
class Miaosha extends Component {
    constructor(){
        super();
        this.state={
            daojishi:['00','00','00']
        }
    }
    render() {
        const {miaoshaList} = this.props;
        return (
            <div className="miaosha">
                <div className="ms_list">
                    <ul>
                        {miaoshaList.map(item=><li key={item.item_id}>
                            <div>
                                <img src={item.image_url} />
                            </div>
                            <div>aaa</div>
                            <div>aaa</div>
                        </li>)}

                    </ul>

                </div>
            </div>
        );
    }
}

export default Miaosha;
```

## 9.6 秒杀的倒计时
 修改了 src/pages/main/index.js
 ```
   {/* 秒杀组件 ,组件中有可以获取不到nowTime和endTime,使用三木运算符先做判断 */}
                {
 -+                   nowTime != 0 && endTime != 0 ?<Miaosha miaoshaList={miaoshaList} nowTime={nowTime} endTime={endTime} />:''
                }
 ```


修改了src/components/main/miaosha.js
```
import React, { Component } from 'react';
import './index.scss';
class Miaosha extends Component {
    constructor(){
        super();
        this.state={
            daojishi:['00','00','00']
        }
    }

+    componentDidMount(){
+        console.log(this.props.nowTime,this.props.endTime);
+        let miaoshaTime = this.props.endTime - this.props.nowTime;
+        //定时器
+        this.inter =setInterval(()=>{
+            miaoshaTime -= 1000;
+            let time = this.formatTime(new Date(miaoshaTime));//将时间戳转日期时间
+            console.log(time);
+            this.setState({
+                daojishi:time
+            })
+        },1000);
+    }
    //时间戳转日期时间
+    formatTime=(date)=>{
+        let time = date/1000;
+        const s = Math.floor(time%60);
+        const m = Math.floor(time/60%60);
+        const h = Math.floor(time/60/60%24);
+        return [h,m,s].map(this.addZero);
+    }
    //没有十位在十位补零
+    addZero(n){
+        if(n>9){
+            return n;
+        }else{
+            return "0"+n;
+        }
+    }
    render() {
        const {miaoshaList} = this.props;
        const {daojishi} = this.state;
        return (
            <div className="miaosha">
+                <div className="ms_title">
+                    <div className="ms_title_0">
+                        <span>今日秒杀</span>
+                        <span className="daojishi">{daojishi[0]}:{daojishi[1]}:{daojishi[2]}</span>
+                    </div>
+                    <div>更多好货 {">"} </div>
+                </div>
                <div className="ms_list">
                    <ul  className="ms_list-ul">
                        {miaoshaList.map(item=><li key={item.item_id}>
                            <div>
                                <img src={item.image_url} />
                            </div>
                            <div>aaa</div>
                            <div>aaa</div>
                        </li>)}
                    </ul>
                </div>
            </div>
        );
    }
}

export default Miaosha;
``` 

修改了src/components/main/miaosha.scss
```
.miaosha{
    .ms_list{width: 100%; overflow-x: auto; overflow-y: hidden;
        .ms_list-ul{width:22rem; display: flex; justify-content: space-around;
            li{   
                width: 2.53333rem;
                height: 3.97333rem;
                border: 1px solid #ededed;
                border-radius: 0.08rem;
                background: #fff;
                img{width: 100%;}
            }
        }
    }
 +   .ms_title{display: flex; justify-content: space-between; height: 50px; line-height:50px;
 +       .ms_title_0{padding-left:10px; font-size:14px; font-weight: bold;
 +           .daojishi{padding-left:10px;}
 +       }
 +   }
}
```


#### 十.精选
## 10.1 添加api
src/utils/api.js
```
//3.精选必买
export const jingxuanData = async(group_id)=>{
    return await http.get(`item/ws/group_list?current_page=1&page_size=12&group_id=${group_id}&device_id=fd91e420-0f4c-11eb-a595-514ffb010224`);
}
```
## 10.2 新建组件及样式
src/components/main/jingxian/index.js
```
import React, { Component } from 'react';
import './jingxuan.scss';
class Jingxuan extends Component { 
    render() {
        const {jingxuanList} = this.props
        return (
            <ul className="jx">
               {jingxuanList.map(item=><li key={item.item_id}>
                    <img src={item.over_image_url} alt={item.item_id}/>

               </li>)}
            </ul>
        );
    }
}    
export default Jingxuan;    
```

src/components/main/jingxian/jingxuan.scss
```
.jx{display: flex; flex-direction: row; flex-wrap: wrap; justify-content: space-around;
    li{
        width:30%;
        img{width:100%;}
    }

}
```
## 10.3 修改 src/pages/main.js
```
//引入精选组件
import Jingxuan from '../../components/main/jingxuan';
//引入api
import {swiperData,miaoshaData,jingxuanData} from '../../utils/api';

  jingxuanList:[],
            jingxuanNav:[
                {"id":1,"group_id":"36551","name":"爆款让利","activeType":true},
                {"id":2,"group_id":"36552","name":"口碑热荐","activeType":false},
                {"id":3,"group_id":"36553","name":"限时特惠","activeType":false},
                {"id":4,"group_id":"36554","name":"超值低价","activeType":false}
            ]



  componentDidMount(){
        swiperData().then(res=>{
           // console.log(res);
            this.setState({
                swiperList:res.data.data.sylunbo.datas
            })
        })
        //获取秒杀数据
        miaoshaData().then(res=>{
           // console.log(res);
            this.setState({
                miaoshaList:res.data.data.specials_item_v_o_s,
                nowTime:res.data.data.now,
                endTime:res.data.data.specials_time_ranges[0].end
            },function(state){
                console.log(this.state.miaoshaList,this.state.nowTime,this.state.endTime);
            })
        })

        //获取精选数据
  +     this.getJingxuanData(36551);
    }

    //调用精选的数据-新加
    getJingxuanData=(group_id)=>{
        jingxuanData(group_id).then(res=>{
            // console.log(res);
             this.setState({
                 jingxuanList:res.data.data.item_list
             },function(state){
                console.log(this.state.jingxuanList);
             })
         })
    }

    //修改精选的激活链接-新加
    changeNav=(group_id)=>{
        let jingxuan = this.state.jingxuanNav;
        for(var i = 0;i< jingxuan.length;i++){
            if(group_id ===  jingxuan[i].group_id){
                jingxuan[i].activeType = true;
            }else{
                jingxuan[i].activeType = false;
            }
        }
        this.setState({
            jingxuanNav:jingxuan
        })
        this.getJingxuanData(group_id);
    }


render() {
-+        const {swiperList,miaoshaList,nowTime,endTime,jingxuanNav,jingxuanList} = this.state;
        return (
            <div>
                <Mainswiper swiperList={swiperList}/>
                {/* 秒杀组件 ,组件中有可以获取不到nowTime和endTime,使用三木运算符先做判断 */}
                {
                    nowTime !== 0 && endTime !== 0 ?<Miaosha miaoshaList={miaoshaList} nowTime={nowTime} endTime={endTime} />:''
                }
                
+                {/*精选必买好价*/}
+                <ul className="jingxuan">
+                    {jingxuanNav.map(item=><li key={item.id} className={item.activeType?"active":""} onClick={this.changeNav.bind(this,item.group_id)}>
+                        {item.name}
+                    </li>)}
+                </ul>
+                <Jingxuan jingxuanList={jingxuanList}/>
            </div>
        );
    }


```

#### 十一. 如果页面跳转时有报错如下：Can't perform a React state update on an unmounted component
 ```
    componentWillUnmount(){
        clearInterval(this.inter);
        this.setState = (state,callback)=>{
            return;
        }
    }
```
####  十二. 列表和上拉加载更多页
## 12.1 获取数据
src/utils/api.js
```
//4.列表数据
export const listData = async(current_page)=>{
    return await http.get(`item/ws/group_list?current_page=${current_page}&page_size=24&group_id=36097&device_id=fd91e420-0f4c-11eb-a595-514ffb010224`);
}
```
## 12.2 创建 列表页面
src/pages/list/index.js
```
import React, { Component } from 'react';
import './list.scss';
import {listData} from '../../utils/api';
class list extends Component {
    constructor(){
        super();
        this.state={
            listArr:[],
            page:1,//当前页
            end:false
        }
    }
    componentDidMount(){
        listData(this.state.page).then(res=>{
            this.setState({
                listArr:res.data.data.item_list
            })
        })

        //触底加载下一页 需要绑定scroll事件
        this.listScroll();

    }
    //触底加载下一页函数
    listScroll=()=>{
        window.onscroll = ()=>{
            //console.log('滚动事件触发了');
            //滚动离顶部的距离
            let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            //窗口的可视高度
            let  windowHeight = document.documentElement.clientHeight;
            //滚动高度
            let scrollHeight = document.body.scrollHeight;

           // console.log(scrollTop+'|'+windowHeight+'|'+scrollHeight);
            if(scrollHeight - scrollTop <= windowHeight){//触底了
                console.log("触底了");
                //1.page需要加一
                this.setState({
                    page:this.state.page+1
                })
                //2.重新请求数据
                this.moreData();
            }
        }
    }

    //重新获取数据
    moreData=()=>{
        if(!this.state.end){
            listData(this.state.page).then(res=>{
                let newData = res.data.data.item_list;
                if(newData !== undefined){
                    let oldData = this.state.listArr;
                    //需要将新数据放到旧数据的后面
                    let sumData = oldData.concat(newData);
                    //将总数据保存到 state
                    this.setState({
                        listArr:sumData
                    })
                }else{
                    console.log("已经到底了");
                    this.setState({
                        end:true
                    })
                }
            })
        }
        
    }

    render() {
        const {listArr,end} = this.state;
        return (
            <div className="list">
                <h2>{'<'} <span>跨品牌全场买三免一</span></h2>
                <ul className="l_ul">
                    {
                        listArr.map(item=><li key={item.item_id}>
                            <img src={item.over_image_url} alt={item.item_id}/>
                        </li>)
                    }
                </ul>
                {
                    end?<div >已经到底了，请放过我吧！</div>:''
                }
                
            </div>
        );
    }
}

export default list;
```

src/pages/list/list.scss
```
.list{
    h2{font-size: 16px; font-weight: bold; height:50px; line-height: 50px;border-bottom:1px solid #ccc;
        span{padding-left:2.666667rem; }
      
    }
    .l_ul{
        display: flex; flex-wrap: wrap; justify-content: space-around;
        li{
            width: 45%;
            img{width: 100%;}
        }
    }  
}
```
## 12.3 添加路由
src/router/index.js
```
import list from "../pages/list";
<Route path="/list" component={list} />
```

## 12.4 更改了头部效果
src/components/common/myheader.js
```
//头部
import React, { Component } from 'react';
-+ import {NavLink,withRouter} from 'react-router-dom';
//引入小图标
import {UserOutlined,ShoppingCartOutlined,SearchOutlined} from '@ant-design/icons';
//引入antd的行列
import { Row, Col,Input  } from 'antd';
//引入样式
import "./myheader.scss";
class Myheader extends Component {
    render() {
       // console.log(this.props);
+        const {pathname} = this.props.location;
        return (
+            <div>{
+                pathname === '/' || pathname === '/mask' || pathname === '/global'?
                <div>
                    <Row className="hsearch" >
                        <Col span={4} className="user"><UserOutlined  /></Col>
                        <Col span={16}><Input placeholder="保湿面膜0.1元" prefix={<SearchOutlined />} className="search" /></Col>
                        <Col span={4} className="shop" ><ShoppingCartOutlined /></Col>
                    </Row>
                    <div className="hnav">
                        <NavLink to="/" exact={true}>今日推荐</NavLink>
                        <NavLink to="/mask">面膜中心</NavLink>
                        <NavLink to="/global">购全球</NavLink>
                    </div>
                </div>
+                :""
+                }               
+            </div>
        );
    }
}
-+ export default withRouter(Myheader);

```

#### 十三 内容页及购物车操作
## 13.1 创建 内容页及购物车页面
src/pages/item/index.js
```
import React, { Component } from 'react';

class item extends Component {
    render() {
        return (
            <div>
                内容页
            </div>
        );
    }
}

export default item;
```
src/pages/item.item.scss
```  
.item{
    h2{font-size: 16px; font-weight: bold; height:50px; line-height: 50px;border-bottom:1px solid #ccc; color:#4a4a4a;
        span{padding-left:10px; }
    }
    img{width:100%;}
    .btn{ display: flex; justify-content: space-around; height: 50px; width: 100%; line-height: 50px; position: fixed;
    bottom: 10px;border-top:1px solid #ccc; padding-top:10px;
        div:nth-of-type(1){
            width: 45%;
            border:1px solid #000;
            text-align: center;
            
        }
        div:nth-of-type(2){
            width: 45%;
            background-color: #000;
            color:#fff;
            text-align: center;
        }
        
    }
    .icon-btn{position: fixed; right:10px; bottom:100px; width: 50px; font-size:18px;
        span{ display: inline-block; width:50px; height:50px; border:1px solid #ccc; border-radius: 50%; line-height:50px;}
    }
}`
```
src/pages/shop/index.js
```
import React, { Component } from 'react';

class shop extends Component {
    render() {
        return (
            <div>
                购物车
            </div>
        );
    }
}

export default shop;
```
## 13.2 写路由
```
import item  from '../pages/item';
import shop from '../pages/shop';

 <Route path="/item" component={item} />
   <Route path="/shop" component={shop} />
```
## 13.3 修改内容页 ，将数据写入缓存 
src/pages/item/index.js
```
import React, { Component } from 'react';
import {HomeOutlined,ShoppingCartOutlined} from '@ant-design/icons';

import './item.scss';

class item extends Component {
    goHome=()=>{
        this.props.history.push('/');
    }
    goShop=()=>{
        this.props.history.push('/shop');
    }
    //加入购物车
    addShop=()=>{
        /*
        1.将商品的值传入缓存：名称、图片、价格、数量、商品id
        2.同一个商品，数量加一；不同的商品，push一个新商品到缓存
        */ 
        //1.获取缓存中的数据
        //将缓存转对象
        var myCart = JSON.parse( localStorage.getItem('cart'));
        var data = [];//保存将要放到缓存中的数据
        var itemObj = this.props.location.state;
        var type = true;
        if(myCart !== null  &&  myCart.length){//缓存有数据   
            //如果是同种商品，需要更改商品数量
            myCart.map(item=>{
                console.log(itemObj.item_id ,item.id);
                if(itemObj.item_id === item.id){//同种商品
                    item.num++;
                    type = false;//修改操作
                }    
                data.push(item);//原商品
            })                 
        }

        //追加新记录
        if(type){
            data.push({
                id:itemObj.item_id,
                name:itemObj.item_name,
                pic:itemObj.over_image_url,
                price:itemObj.max_price,
                num:1
            });
        }
        
        //存缓存
        localStorage.setItem('cart',JSON.stringify(data));



    }
    render() {
        console.log(this.props.location.state);
        let {over_image_url,item_id,item_name,item_long_name} = this.props.location.state
        return (
            <div className="item">
                <h2>{'<'} <span>{item_name}</span></h2>
                <img src={over_image_url} alt={item_id}/><br/>
                <div>{item_long_name}</div>
                <div className="btn">
                    <div onClick={this.addShop}>加入购物车</div>
                    <div>立即购买</div>
                </div>
                <div className="icon-btn" >
                <HomeOutlined onClick={this.goHome}/>
                <ShoppingCartOutlined onClick={this.goShop}/>
                </div>
            </div>
        );
    }
}

export default item;
```
## 13.4 在首页添加链接地址 
src/components/main/jingxuan/index.js
```
import {Link} from 'react-router-dom';

<Link to={{pathname:"/item",state:item}}>
    <img src={item.over_image_url} alt={item.item_id} />
</Link>

```

#### 十四. Promise.all Promise.allSettled
  修改了 src/pages/main/index.js
```
 //获取精选的四组数据
        //for循环获取异步数据，存在顺序问题
        var list = this.state.jingxuanNav;
        var test = [];//保存promise的内容
        for(var i = 0;i < list.length;i++ ){
            test.push( jingxuanData(list[i].group_id));
        }
        //获取一组异步数据，将并行获取数据转同步； Promise.all缺点：如果有一个异步出错，然后就会中断，后面的都不会执行
        //Promise.allSettled
        /*
        当我们处理多个promise时，尤其是当它们相互依赖时，记录每个事件在调试中发生的错误可能很有用。
            使用Promise.allSettled，它会创建一个新的promise，在所有promise完成后返回一个包含每个promise结果的数组。
            Promise.allSettled跟``Promise.all类似 都是进行并发请求，但是，我们在上面的两个例子中，显然是已经看到了他们的一些区别，
            在使用Promise.all进行并发请求的时候，只要有一个请求出现问题（异常），所有的请求正常的也都不能拿到数据，
            但是在我们的业务的开发中，我们需要保障我们业务的最大的可访问性，就是在我们执行并发任务中，
            不管我这个并发任务中的一任何个任务是正常还是异常，我们都需要拿到返回的对应的状态，
            在ES11中Promise.allSettled就为我们解决了这个问题，它和Promise.all类似,参数接受一个Promise的数组,
            返回一个新的Promise,也就是说当Promise全部处理完成后,我们可以拿到每个Promise的状态, 而不管是否处理成功。
            我们可以在then里面通过filter来过滤出想要的业务逻辑结果，这样就解决了Promise.all` 的缺
            */
            Promise.allSettled(test).then(res=>{
                console.log(res);
            });

```

#### 十五. 购物车小图标的徽标数
修改了 src/pages/item/index.js
```
import { message,Badge } from 'antd';
 constructor(){
        super();
        this.state={
            count:0
        }
    }
 componentDidMount(){
       this.totalNum();
    }
    //计算购物车总数量
    totalNum=()=>{
        //计算商品数量并显示
        let arr = JSON.parse(localStorage.getItem('cart'));
        let count = 0;
        if(arr !== null && arr.length){
            for(var i = 0;i<arr.length;i++){
                count += arr[i].num;
            }
        }
        this.setState({
            count:count
        })

    }

 -+  <HomeOutlined onClick={this.goHome} className="home"/>
 -+   <Badge count={count}><ShoppingCartOutlined onClick={this.goShop} className="shop"/></Badge>  

```

src/pages/item/item.scss
```
-+ .home,.shop{ display: inline-block; width:50px; height:50px; border:1px solid #ccc; border-radius: 50%; line-height:50px;}
```

#### 十六. 登录
## 16.1 页面 
src/pages/login/index.js
src/pages/login/login.scss
src/pages/center/index.js
## 16.2 路由
```
import login from '../pages/login';
import center from '../pages/center';
<Route path="/login" component={login} />
<Route path="/center" component={center} />
```
## 16.3 api
src/utils/api.js
```

//5.发送验证码
export const sendSmsCode = async(phone)=>{
    return await http.get(`http://10.10.10.250:7001/sms/addSms?phone=${phone}`);
}
//6.登录接口
export const sendLogin = async(params)=>{
    console.log(params);
    return await http.post(`http://10.10.10.250:7001/user/login`,params);
}
```

## 16.4 修改 登录页面
src/pages/login/index.js
```
参看页面代码
```

#### 十七. 头部的红色徽标
src/pages/item/index.js
```
totalNum=()=>{
        //计算商品数量并显示
        let arr = JSON.parse(localStorage.getItem('cart'));
        let count = 0;
        if(arr !== null && arr.length){
            for(var i = 0;i<arr.length;i++){
                count += arr[i].num;
            }
        }
        this.setState({
            count:count
        })
        //将总数量保存到缓存
+        localStorage.setItem('count');
    }
```
src/components/common/myheader/index.js
```
-+import { Row, Col,Input,Badge  } from 'antd';
-+ <Col span={4} className="shop" ><Badge count={localStorage.getItem('count')}><ShoppingCartOutlined /></Badge></Col>
```


#### 十八.用户中心和路由守卫
## 18.1 添加传token的api
src/utils/http.js
```
let http = {
    get:'',
    post:'',
+    getToken:''
}


http.getToken = function(api,data,token){
    let params = qs.stringify(data);
    return new Promise((resolve,reject)=>{
        axios.get(baseurl+api,{
           headers:{
               'Authorization':token
           } 
        },params).then(res=>{
            resolve(res);
        })
    })
}
```
src/utils/api
```
//用户中心测试token是否过期
export const sendToken = async(token)=>{
    return await http.getToken(`http://10.10.10.250:7001/center`,'',token);
}
```

## 18.2 修改路由
添加src/router/config.js
```
//配置所有需要守卫的路由
import center from '../pages/center';
import shop from '../pages/shop';

export const routerConfig = [
    {
        path:'/center',
        component:center,
        auth:true
    },
    {
        path:'/shop',
        component:shop,
        auth:true
    }
];
```

修改了src/router/index.js
```
//路由
import React from 'react';
-+import {Route,BrowserRouter,Switch} from 'react-router-dom';
//引入页面
import main from '../pages/main';
import global from '../pages/global';
import mask from '../pages/mask';
import list from "../pages/list";
import item  from '../pages/item';
-// import shop from '../pages/shop';
import login from '../pages/login';
-// import center from '../pages/center';
//引入组件 ,组件的名称首字母必须大写
import Myheader from '../components/common/myheader.js';

+import {routerConfig} from './config'; 
+import Auth from '../components/common/auth';
//路由表
const App = ()=>(
    <BrowserRouter>
        <div>
            <Myheader />
        </div>
        <div>
+            <Switch>
                <Route path="/" exact={true} component={main} />
                <Route path="/mask" component={mask} />
                <Route path="/global" component={global} />
                <Route path="/list" component={list} />
                <Route path="/item" component={item} />
-                {/* <Route path="/shop" component={shop} /> */}
                <Route path="/login" component={login} />
-                {/* <Route path="/center" component={center} /> */}
+                <Auth config={routerConfig}></Auth>
+            </Switch>
        </div>
    </BrowserRouter>
)
//输出路由
export default App;
```
## 18.3 添加守卫插件
src/components/common/auth.js
```
//守卫的组件
import React, { Component } from 'react';
import {Redirect,withRouter,Route} from 'react-router-dom';
import {sendToken} from '../../utils/api';

class Auth extends Component {
    constructor(){
        super();
        this.state={
            tokenType:1
        }
    }
    componentDidMount(){
        //获取token，验证token是否已经过期
        sendToken(localStorage['token']).then(res=>{
            console.log(res);
            if(res.data.code === 0){//登录成功
                this.setState({
                    tokenType:true
                })
            }else{
                this.setState({
                    tokenType:false
                })
            }
        })

    }
    render() {
        console.log(this.props.config);
        const {tokenType} = this.state;
        const {pathname} = this.props.location;
        //console.log(this.props);
        const {config} = this.props;
        // 找到当前页面的path和component
        let nowRouter = config.find(v=>v.path=== pathname);
        if(tokenType){
            return (
               <Route path={pathname} component={nowRouter.component} />
            );
        }else{
            return(
                <Redirect to = "/login"/>
            )
           
        }
       
    }
}

export default withRouter( Auth);
```

#### 十九.组件传参验证
src/components/main/jingxuan/index.js
```
import PropTypes from 'prop-types';
Jingxuan.propTypes = {
    jingxuanList:PropTypes.array.isRequired
}
```

https://react.docschina.org/docs/typechecking-with-proptypes.html

#### 二十. 购物车没有数据时的提示
src/pages/shop/index.js

```
 render() {
        const {listData} = this.state;
        return (
            <div className="shop">
                <h2>{'<'} <span>购物车</span></h2>
                {
                    listData.length === 0?<div>购物车为空</div>:<div >
                    {
                        listData.map(item=><div key={item.id} className="s_list">
                           <div className="s_l_1">
                               <input type="checkbox" name="check" checked={item.checkType} onChange={()=>this.changeType(item.id)}/></div>
                           <div className="s_l_2"><img src={item.pic}  alt={item.id}/></div>
                           <div className="s_l_3">{item.name}</div>
                            
                        </div>)
                    }
                    
                </div>
                }
                <div style={listData.length === 0?{display:"none"}:{display:"block"}}><input type="checkbox" name="allcheck"  ref={this.allCheck} onChange={this.checkAll}/></div>
            </div>
        );
    }
```

#### 二十一.封装高阶组件
## 21.1 创建高阶组件
src/components/common/hoc/withGoBack.js
```
//返回的高阶组件
/*
高阶组件 hoc ,作用是：封装，一般可以封装状态值、函数、钩子函数
高阶组件的特点： 本身是一个函数，参数是一个组件，返回值是一个新组件，相当于vue的mixin，但是消除了mixin的副作用
*/
import React,{Component} from 'react'; 

const withGoBack = WrappedComponent=>{
    return class extends Component{
        goBack=()=>{
            this.props.history.go(-1);
        }
        render(){
            return <WrappedComponent goBack={this.goBack} {...this.props}></WrappedComponent>
        }
    }
}
export default withGoBack;
```
## 21.2 使用高阶组件
/*
高阶组件 hoc ,作用是：封装，一般可以封装状态值、函数、钩子函数
高阶组件的特点： 本身是一个函数，参数是一个组件，返回值是一个新组件，相当于vue的mixin，但是消除了mixin的副作用
*/

src/pages/item/index.js
```
//引入高阶组件
import withGoBack from '../../components/common/hoc/withGoBack';

<h2><span onClick={this.props.goBack}>{'<'}</span><span>{item_name}</span></h2>

export default withGoBack(item);
```

#### 二十二. 面试题
https://segmentfault.com/a/1190000016885832
https://blog.csdn.net/eyeofangel/article/details/88797314
react 新特性
react 优化

